(function(o){var i=[],g=[],f=function(b){var a;a:if(Array.prototype.indexOf)a=i.indexOf(b);else{for(a=0;a<i.length;a++)if(i[a]===b)break a;a=-1}if(0<=a)return a;i[i.length]=b;g[g.length]={_functions:[],_current:null,_error_handler:null,_async:!1,_returns:!1,_running:0};return i.length-1},m=function(b,a){var c=a||!1,l=f(b),h=g[l],k=h._functions;if("function"===typeof k[0]){var d=k.shift(),j=[],e=function(){k.length&&"function"!==typeof k[0]&&(j.push(k.shift()),e())};e();h._current=[d].concat(j);return function(){if(c)h._async=
!1,h._running--;var e=Array.prototype.slice.call(arguments);if(h._returns)for(var a=0;a<e.length;a++)null!=e[a]&&(j[a]=e[a]);if(e=h._error_handler)try{var f=d.apply(b,j)}catch(n){return e.call(b,n)}else f=d.apply(b,j);if(!h._async){"undefined"===typeof f&&h._running++;if(k.length)return m(b)(f);h._after?0===h._running&&(f=h._after.apply(b,[f]),i.splice(l,1),g.splice(l,1)):(i.splice(l,1),g.splice(l,1));return f}}}throw Error("no function to run");},n=function(b,a){if(a)return g[b][a];throw Error("property not given");
},p=function(b,a,c){if(a)return g[b][a]=c,g[b][a];throw Error("property not given");},d=function(b,a){var c=a||{},d=c.fallback||null,h="function"===typeof c.before?c.before:null,i="function"===typeof c.after?c.after:null,o="function"===typeof c.error?c.error:null,j=!c.noreturn;if(null==b)if(d)b="function"===typeof fallabck?d.call(b):d;else return function(){return null};b=Object(b);c=function(){var e=f(b),e=g[e];e._error_handler=o;e._after=i;e._returns=j;e._running=0;var a=e._functions,c=!(a.length||
e._async);h&&a.push(h);var d=1===arguments.length&&"function"!==typeof arguments[0]?arguments[0]:Array.prototype.slice.call(arguments),a=a.concat(d);e._functions=a;if(c)return m(b)()};c.set=function(e,a){return p(f(b),e,a)};c.get=function(a){return n(f(b),a)};c.clear=function(){var a=f(b),c=g[a]._functions;c.splice(0,c.length);g[a]._async=!1};c.next=function(){var a=f(b);g[a]._async=!0;return m(b,!0)};c.done=function(a){var c=b,d=f(c),d=g[d];0<d._running&&0==--d._running&&d._after.apply(c,[a])};c.recurse=
function(){var a=f(b),a=g[a],c=Array.prototype.slice.call(arguments);a._async=!0;Array.prototype.unshift.apply(a._functions,a._current);a._current=null;return m(b,!0).apply(b,c)};return c};d.get=function(b){var a=f(this);return n(a,b)};d.set=function(b,a){var c=f(this);return p(c,b,a)};d.invoke=function(){var b=Array.prototype.slice.call(arguments);1===b.length&&"string"!==typeof b[0]&&(b=b[0]);return this[b.shift()].apply(this,b)};if("undefined"!==typeof exports){if("undefined"!==typeof module&&
module.exports)module.exports=d;exports.Sugarless=d}else o.Sugarless=d})(this||window);
